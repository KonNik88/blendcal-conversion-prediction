# ---- BlendCAL UI (Streamlit) ----
FROM python:3.11-slim

ENV PYTHONDONTWRITEBYTECODE=1     PYTHONUNBUFFERED=1     PIP_NO_CACHE_DIR=1

WORKDIR /app

COPY requirements-ui.txt /tmp/requirements.txt
RUN pip install --upgrade pip && pip install -r /tmp/requirements.txt

# Copy only UI app
COPY app /app/app

# Optional assets inside app/app/assets if present
# Copy VERSION & MODEL_INFO.json to show in UI 
COPY MODEL_INFO.json /app/MODEL_INFO.json
COPY VERSION /app/VERSION

# Default API endpoint for the UI (can be overridden via .env or compose)
ENV BLENDCAL_API=http://api:8000

EXPOSE 8501

# Streamlit config tweaks to run well in container
ENV STREAMLIT_SERVER_HEADLESS=true     STREAMLIT_SERVER_PORT=8501     STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

# Entrypoint
CMD ["streamlit", "run", "app/streamlit_app.py"]